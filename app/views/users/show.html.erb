<% user = @user %>
<% owner = is_owner?(user, current_user) %>
<% title user.name %>

<section class="l-app -full">

  <div class="l-app-map">
    <div id="map" class="c-map"></div>
  </div>

  <%= render "shared/legend_people" %>

  <div class="l-app-title">
    <div class="wrapper">
      <div class="row collapse">
        <div class="column small-8">
          <div class="c-avatar -big -mg-bt">
            <%= image_tag(user.avatar_url) %>
          </div>
        </div>
      </div>
      <div class="row collapse">
        <div class="column small-8">
          <div class="c-title-btn">
            <% if not_blank?(user.name) %>
              <h1><%= user.name %></h1>
            <% end %>
            <% if owner %>
              <%= link_to (t 'edit'), edit_user_path(current_user.id), class: "c-btn -transparent" %>
            <% end %>
          </div>
          <div class="row">
            <div class="column small-12 medium-6">
              <ul class="c-pipe-list">
                <li>
                  <% if user.investigator.present? && user.investigator.organizations.any? %>
                    <%= user.investigator.organizations.first.try(:name) %>
                  <% end %>
                </li>
                <% if user.position.present? && user.position != '' %>
                  <li><%= user.position %></li>
                <% end %>
              </ul>
              <ul class="c-pipe-list">
                <li><%= @following %> Following</li>
                <li><%= @followers %> Followers</li>
              </ul>
            </div>
            <div class="column small-12 medium-6">
              <ul class="c-pipe-list">
                <% if not_blank?(user.twitter_account) %>
                  <li>
                    <a href="https://twitter.com/<%= user.twitter_account %>" class="-clickable -hv" target="_blank">
                      Twitter
                    </a>
                  </li>
                <% end %>
                <% if not_blank?(user.linkedin_account) %>
                  <li>
                    <a href="https://www.linkedin.com/in/<%= user.linkedin_account %>" class="-clickable -hv" target="_blank">
                      Linkedin
                    </a>
                  </li>
                <% end %>
                <% if not_blank?(user.pubmed) %>
                  <li>
                    <a href="http://www.ncbi.nlm.nih.gov/pubmed?term=<%= user.pubmed %>%5BAuthor%5D" class="-clickable -hv" target="_blank">
                      Pubmed
                    </a>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
        <div class="column small-4">
           <% if (current_user) %>
            <%= render "shared/user_actions" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="l-app-navbar">
    <div class="wrapper">
      <div class="row collapse">
        <div class="column small-6">
          <ul class="c-tabnav" id="dataTabNav">
             <% @filters.each do |filter| %>
              <li class="tabnav-item">
                <%= link_to t(filter),
                  map_path(request.query_parameters.merge({ data: filter })),
                  class: "-secondary js-btn-mapmenu-type",
                  remote: true,
                  data: { datatype: filter }
                %>
                <% if filter === 'messages' %>
                  <div class="c-badge <%= filter + '-badge' %><%= current_user.unread_inbox_count === 0 ? ' -hidden' : '' %>"><%= current_user.unread_inbox_count %></div>
                <% end %>
              </li>
            <% end %>
          </ul>
        </div>
        <div class="column small-6">
          <div id="toolbar"></div>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="l-grid" id="content">
  <% if @current_type === 'projects' %>
    <%= render 'projects/list', items: @items, more: @more %>
  <% elsif @current_type === 'events' %>
    <%= render 'events/list', items: @items, more: @more %>
  <% elsif @current_type === 'posts' %>
    <%= render 'posts/list', items: @items, more: @more %>
  <% elsif @current_type === 'messages' %>
      <% if owner %>
        <%= render 'messages/list', items: @items, more: @more %>
      <% end %>
  <% elsif @current_type === 'network' %>
    <%= render 'network' %>
  <% end %>
</div>
