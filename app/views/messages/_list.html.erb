<% if items && items.size() > 0 %>
  <div class="row collapse">
    <% items.each do |c| %>
      <div class="column small-12">
        <div class="c-card -messages -thin c-conversation">
          <div class="conversation-subject js-subject-action">
            <% conversation_person = conversation_person(c) %>
            <h2><%= c.subject %></h2>
            <h3><%= conversation_person.investigator.try(:name) %></h3>
          </div>
          <div class="conversation-body">
            <ul class="messages">
              <% c.messages.each do |m| %>
                <% message_person = sender(m.sender_id) %>
                <li class="c-conversations-item <%= (m.sender_id == current_user.id) ? '-mine' : '-theirs' %>">
                  <div class="sender">
                    <h3><%= message_person.investigator.try(:name) %></h3>
                    <small><%= m.created_at.strftime("%d.%m.%Y") %> <%= m.created_at.strftime("%H:%M")%></small>
                  </div>
                  <div class="message">
                    <%= m.body %>
                  </div>
                </li>
              <% end %>
            </ul>
            <div class="message-form">
              <%= form_for Mailboxer::Message.new, url: :message, remote: true, as: :message do |f| %>
                <div class="form-row">
                  <%= f.text_area :body, class: '-border -padding', rows: 5, placeholder: 'Text here your response' %>
                  <%= f.hidden_field :in_response, value: c.messages.last.id %>
                  <%= f.hidden_field :data, value: 'messages' %>
                  <%= f.submit 'Send', class: 'c-btn -primary' %>
                </div>
              <% end %>
            </div>
          </div>

          <div class="details">
          </div>
          <p></p>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="row collapse">
    <div class="column small-12">
      <div class="c-card">
        <p>No messages</p>
      </div>
    </div>
  </div>
<% end %>

<% if more %>
  <div class="row collapse">
    <div class="column small-12">
      <div class="c-card">
        <% page = @page + 1 %>
        <%= link_to (t 'show_more'),
          {
            :params => request.query_parameters.merge({ page: page })
          },
          class: "c-btn -circle",
          id: 'showMoreButton',
          remote: true
        %>
      </div>
    </div>
  </div>
<% end %>
